{"version":3,"file":"preact-localization.esm.js","sources":["../src/components/provider.js","../node_modules/dlv/dist/dlv.umd.js","../src/lib/translate.js","../src/lib/template.js","../src/components/text.js","../src/lib/util.js","../src/components/localizer.js","../src/lib/translate-mapping.js","../src/components/markup-text.js"],"sourcesContent":["import { h, createContext } from 'preact'\n\nexport const Context = createContext()\n\nexport const IntlProvider = ({ children, dictionary }) => (\n  <Context.Provider value={dictionary}>{children}</Context.Provider>\n)\n","!function(t,n){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=function(t,n,e,i,o){for(n=n.split?n.split(\".\"):n,i=0;i<n.length;i++)t=t?t[n[i]]:o;return t===o?e:t}:\"function\"==typeof define&&define.amd?define(function(){return function(t,n,e,i,o){for(n=n.split?n.split(\".\"):n,i=0;i<n.length;i++)t=t?t[n[i]]:o;return t===o?e:t}}):t.dlv=function(t,n,e,i,o){for(n=n.split?n.split(\".\"):n,i=0;i<n.length;i++)t=t?t[n[i]]:o;return t===o?e:t}}(this);\n//# sourceMappingURL=dlv.umd.js.map\n","import dlv from 'dlv'\nimport template from './template'\n\nexport default function translate(\n  id,\n  dictionary,\n  fields,\n  plural,\n  fallback = null\n) {\n  let value = dictionary && id && dlv(dictionary, id)\n\n  if ((plural || plural === 0) && value && typeof value === 'object') {\n    if (plural === 0) {\n      value = value.none\n    } else if (plural === 1) {\n      value = value.one\n    } else {\n      value = value.many\n    }\n  }\n\n  return (value && template(value, fields)) || fallback\n}\n","import dlv from 'dlv'\n\nexport default function template(string, fields) {\n  return (\n    string &&\n    string.replace(/\\{\\{([\\w.-]+)\\}\\}/g, (_, field) => {\n      let value = dlv(fields, field)\n      if (value == null) {\n        return ''\n      }\n\n      // Allow for recursive {{config.xx}} references:\n      if (typeof value === 'string' && value.match(/\\{\\{/)) {\n        value = template(value, fields)\n      }\n\n      return value\n    })\n  )\n}\n","import { h } from 'preact'\nimport translate from '../lib/translate'\nimport { Context } from './provider'\n\nexport const Text = ({ id, children, plural, fields }) => (\n  <Context.Consumer>\n    {dictionary => translate(id, dictionary, fields, plural, children)}\n  </Context.Consumer>\n)\n","export function escapeHtml(text) {\n  const map = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#039;'\n  }\n\n  return text.replace(/[&<>\"']/g, m => map[m])\n}\n","import { h, cloneElement, toChildArray } from 'preact'\nimport translateMapping from '../lib/translate-mapping'\nimport { Context } from './provider'\n\nexport const Localizer = ({ children }) => (\n  <Context.Consumer>\n    {dictionary =>\n      toChildArray(children).map(child =>\n        cloneElement(child, translateMapping(child.props, dictionary))\n      )\n    }\n  </Context.Consumer>\n)\n","import translate from './translate'\nimport { Text } from '../components/text'\n\nexport default function translateMapping(props, dictionary) {\n  const out = {}\n\n  for (const name in props) {\n    if (props.hasOwnProperty(name) && props[name]) {\n      const def = props[name]\n\n      if (def.type === Text) {\n        const { props } = def\n        out[name] = translate(\n          props.id,\n          dictionary,\n          props.fields,\n          props.plural,\n          props.children\n        )\n      }\n    }\n  }\n\n  return out\n}\n","import { h } from 'preact'\nimport { escapeHtml } from '../lib/util'\nimport { Text } from './text'\nimport { Localizer } from './localizer'\n\nfunction Markup({ as, text, ...props }) {\n  if (!text) {\n    return text\n  }\n\n  const Element = as || 'span'\n  return typeof text === 'string' ? (\n    <Element\n      {...props}\n      dangerouslySetInnerHTML={{ __html: text.replace(/\\n/g, '<br/>') }}\n    />\n  ) : (\n    <Element>{text}</Element>\n  )\n}\n\nexport function MarkupText({ as, class: className, fields, ...props }) {\n  for (let key in fields) {\n    fields[key] = escapeHtml(new String(fields[key]))\n  }\n\n  return (\n    <Localizer>\n      <Markup\n        as={as}\n        class={className}\n        text={<Text {...props} fields={fields} />}\n      />\n    </Localizer>\n  )\n}\n"],"names":["Context","createContext","IntlProvider","h","Provider","value","module","t","n","e","i","o","split","length","translate","id","dictionary","fields","plural","fallback","let","dlv","none","one","many","template","string","replace","_","field","match","Text","Consumer","children","escapeHtml","text","const","map","&","<",">","\"","'","m","Localizer","toChildArray","child","cloneElement","props","out","name","hasOwnProperty","def","type","translateMapping","Markup","Element","as","dangerouslySetInnerHTML","__html","MarkupText","key","String","class","className"],"mappings":"sFAEaA,EAAUC,IAEVC,qBACXC,EAACH,EAAQI,UAASC,qMCLLC,UAAoE,SAASC,EAAEC,EAAEC,EAAEC,EAAEC,GAAG,IAAIH,EAAEA,EAAEI,MAAMJ,EAAEI,MAAM,KAAKJ,EAAEE,EAAE,EAAEA,EAAEF,EAAEK,OAAOH,IAAIH,EAAEA,EAAEA,EAAEC,EAAEE,IAAIC,EAAE,OAAOJ,IAAII,EAAEF,EAAEF,+BCGrK,SAASO,EACtBC,EACAC,EACAC,EACAC,EACAC,kBAAW,MAEXC,IAAIf,EAAQW,GAAcD,GAAMM,EAAIL,EAAYD,GAYhD,OAVKG,GAAqB,IAAXA,IAAiBb,GAA0B,iBAAVA,IAE5CA,EADa,IAAXa,EACMb,EAAMiB,KACM,IAAXJ,EACDb,EAAMkB,IAENlB,EAAMmB,MAIVnB,GCpBK,SAASoB,EAASC,EAAQT,GACvC,OACES,GACAA,EAAOC,QAAQ,8BAAuBC,EAAGC,GACvCT,IAAIf,EAAQgB,EAAIJ,EAAQY,GACxB,OAAa,MAATxB,EACK,IAIY,iBAAVA,GAAsBA,EAAMyB,MAAM,UAC3CzB,EAAQoB,EAASpB,EAAOY,IAGnBZ,KDMMoB,CAASpB,EAAOY,IAAYE,MElBlCY,mEACX5B,EAACH,EAAQgC,uBACNhB,UAAcF,EAAUC,EAAIC,EAAYC,EAAQC,EAAQe,MCNtD,SAASC,EAAWC,GACzBC,IAAMC,EAAM,CACVC,IAAK,QACLC,IAAK,OACLC,IAAK,OACLC,IAAK,SACLC,IAAK,UAGP,OAAOP,EAAKR,QAAQ,oBAAYgB,UAAKN,EAAIM,SCL9BC,sCACXzC,EAACH,EAAQgC,uBACNhB,UACC6B,EAAaZ,GAAUI,aAAIS,UACzBC,EAAaD,ECLN,SAA0BE,EAAOhC,GAC9CoB,IAAMa,EAAM,GAEZ,IAAKb,IAAMc,KAAQF,EACjB,GAAIA,EAAMG,eAAeD,IAASF,EAAME,GAAO,CAC7Cd,IAAMgB,EAAMJ,EAAME,GAElB,GAAIE,EAAIC,OAAStB,EAAM,CACbiB,cACRC,EAAIC,GAAQpC,EACVkC,EAAMjC,GACNC,EACAgC,EAAM/B,OACN+B,EAAM9B,OACN8B,EAAMf,WAMd,OAAOgB,EDfmBK,CAAiBR,EAAME,MAAOhC,oIEH1D,SAASuC,8CACP,IAAKpB,EACH,OAAOA,EAGTC,IAAMoB,EAAUC,GAAM,OACtB,MAAuB,iBAATtB,EACZhC,EAACqD,sBAECE,wBAAyB,CAAEC,OAAQxB,EAAKR,QAAQ,MAAO,aAGzDxB,EAACqD,OAASrB,GAIP,SAASyB,oEACd,IAAKxC,IAAIyC,KAAO5C,EACdA,EAAO4C,GAAO3B,EAAW,IAAI4B,OAAO7C,EAAO4C,KAG7C,OACE1D,EAACyC,OACCzC,EAACoD,GACCE,GAAIA,EACJM,MAAOC,EACP7B,KAAMhC,EAAC4B,mBAASiB,GAAO/B,OAAQA"}